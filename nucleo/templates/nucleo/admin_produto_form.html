{% extends 'nucleo/base.html' %}

{% block title %}{% if produto %}Editar Produto{% else %}Adicionar Produto{% endif %} - NerdHub{% endblock %}

{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/style_perfil_novo.css' %}">

<div class="container mx-auto px-6 py-8 min-h-screen">
    <div class="mb-8">
        <a href="{% url 'nucleo:admin_produtos' %}" class="text-primary hover:text-teal-600 transition-colors">
            <i class="ri-arrow-left-line"></i> Voltar para Lista de Produtos
        </a>
        <h1 class="text-3xl text-white font-bold mt-4 mb-2">
            {% if produto %}Editar Produto{% else %}Adicionar Novo Produto{% endif %}
        </h1>
        <p class="text-gray-400">Preencha os campos abaixo para {% if produto %}atualizar{% else %}cadastrar{% endif %} o produto</p>
    </div>

    <div class="glass-effect p-8">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="grid grid-cols-2 gap-6">
                <!-- Nome do Produto -->
                <div class="col-span-2">
                    <label class="block text-white text-sm font-medium mb-2">Nome do Produto *</label>
                    <input type="text" name="nome" value="{{ produto.nome|default:'' }}" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Ex: Mouse Gamer RGB">
                </div>

                <!-- Descrição -->
                <div class="col-span-2">
                    <label class="block text-white text-sm font-medium mb-2">Descrição</label>
                    <textarea name="descricao" rows="4" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Descreva o produto...">{{ produto.descricao|default:'' }}</textarea>
                </div>

                <!-- Preço -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Preço (R$) *</label>
                    <input type="number" name="preco" value="{{ produto.preco|default:'' }}" step="0.01" min="0" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="0.00">
                </div>

                <!-- Quantidade em Estoque -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Quantidade em Estoque</label>
                    <input type="number" name="quantidade_estoque" value="{{ estoque.quantidade|default:0 }}" min="0" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="0">
                </div>

                <!-- Marca -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Marca</label>
                    <select name="marca" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">Selecione uma marca</option>
                        {% for marca in marcas %}
                        <option value="{{ marca.id }}" {% if produto.marca.id == marca.id %}selected{% endif %}>{{ marca.nome }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Categoria -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Categoria</label>
                    <select name="categoria" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">Selecione uma categoria</option>
                        {% for categoria in categorias %}
                        <option value="{{ categoria.id }}" {% if produto.categoria.id == categoria.id %}selected{% endif %}>{{ categoria.nome }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Imagem Principal -->
                <div class="col-span-2">
                    <label class="block text-white text-sm font-medium mb-2">
                        Imagem Principal {% if not produto %}*{% endif %}
                    </label>
                    
                    {% if produto and produto.imagem_principal %}
                    <div class="mb-4">
                        <p class="text-gray-400 text-sm mb-2">Imagem atual:</p>
                        <img src="{{ produto.imagem_principal.url }}" alt="{{ produto.nome }}" class="w-48 h-48 object-cover rounded-lg border border-gray-600">
                        <p class="text-gray-400 text-sm mt-2">Selecione uma nova imagem para substituir a atual</p>
                    </div>
                    {% endif %}
                    
                    <input type="file" name="imagem_principal" accept="image/*" {% if not produto %}required{% endif %} class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                    <p class="text-gray-400 text-sm mt-2">Formatos aceitos: JPG, PNG, GIF (Máx: 5MB)</p>
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="flex space-x-4 mt-8">
                <button type="submit" class="bg-primary text-white px-6 py-3 rounded-button whitespace-nowrap hover:bg-teal-600 transition-colors font-medium">
                    <i class="ri-save-line"></i> {% if produto %}Atualizar Produto{% else %}Cadastrar Produto{% endif %}
                </button>
                <a href="{% url 'nucleo:admin_produtos' %}" class="bg-gray-600 text-white px-6 py-3 rounded-button whitespace-nowrap hover:bg-gray-700 transition-colors font-medium">
                    <i class="ri-close-line"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    // Preview da imagem quando selecionada
    document.querySelector('input[name="imagem_principal"]').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.createElement('div');
                preview.className = 'mt-4';
                preview.innerHTML = `
                    <p class="text-gray-400 text-sm mb-2">Preview da nova imagem:</p>
                    <img src="${e.target.result}" class="w-48 h-48 object-cover rounded-lg border border-gray-600">
                `;
                
                // Remove preview anterior se existir
                const oldPreview = document.querySelector('.new-image-preview');
                if (oldPreview) {
                    oldPreview.remove();
                }
                
                preview.classList.add('new-image-preview');
                e.target.parentElement.appendChild(preview);
            };
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
